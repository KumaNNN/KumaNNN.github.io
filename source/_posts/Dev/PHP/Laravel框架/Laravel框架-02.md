---
title: Laravel框架-02
date: 2019-02-28 12:36:17
updated: 2019-02-28 12:36:17 
mathjax: false
categories: 
tags:
typora-root-url: imgs
typora-copy-images-to: imgs
top: 1
---


# 一、==HTTP的请求和响应==

## 1、请求操作


在Laravel中，我们接收用户发送过来的数据或请求，这块内容都是被归纳到HTTP请求操作中。
在Laravel中，处理用户请求操作的内容，都可以使用**Request**类处理。


### 1.1、案例

#### 视图代码

![1539048890958](1539048890958.png)

#### 控制器代码

显示表单代码如下所示：

![1539049068498](1539049068498.png)

接收表单数据代码如下：

![1539049891772](1539049891772.png)

#### 定义路由

![1539049924201](1539049924201.png)

#### 效果如下

![1539049933543](1539049933543.png)



## 2、响应操作

> Laravel框架中对于用户的响应操作分两种，分别是**内容响应操作Response**和**页面跳转响应操作Redirect**

### 2.1、内容响应操作

#### 2.1.1、响应主体内容使用setContent

##### 控制器代码

![1539051437048](1539051437048.png)

##### 定义路由

![1539051466978](1539051466978.png)

##### 效果

![1539051411861](1539051411861.png)

> 注意：
>
> ​	在Laravel框架中，return的时候，会自动帮我们把复合类型的数据转成了json格式。

#### 2.1.2、响应自定义格式内容使用header

#####  控制器代码

![1539051895742](1539051895742.png)

##### 定义路由

![1539051859336](1539051859336.png)

##### 效果

![1539051831833](1539051831833.png)



### 2.2、响应跳转

> 在Laravel框架中，页面跳转属于Http响应操作的一部分，由专门的Redirect类来完成这个操作。

#### 2.2.1、$redirect->to()

> 跳转到指定地址，可以跳转到外网，也可以指定对应的路由规则中 redirect()->to();

##### 控制器代码

![1539052493452](1539052493452.png)

##### 定义路由

![1539052520388](1539052520388.png)

----



# 二、==会话控制==

## 1、cookie操作

### 控制器代码

![1539053432504](1539053432504.png)

### 定义路由

![1539053385170](1539053385170.png)

### 效果

![1539053445074](1539053445074.png)

> 注意：
>
> ​	在Laravel框架中要获取cookie要使用**Request**请求操作类来获取。
>
> 语法：
>
> ​	$request->cookie();	//获取全部cookie
>
> ​	$request->cookie('变量名');	//获取某一个指定的cookie信息
>
> ​	在Laravel框架中，要设置cookie要使用Response响应操作类来设置。
>
> 设置的语法：
>
> ​	$response->cookie($name, $value, $minutes,...);
>
> 参数说明：
>
> ​	$name	[字符串]，变量名
>
> ​	$value	[字符串]，变量值
>
> ​	$minutes	[数值]，生命周期，单位是分钟



## 2、session操作

> Laravel中的session和PHP原生的是不一样的，Laravel中的session是根据PHP的原生session自己实现的一套机制。
>
> **Laravel中的session有两种：**
>
> ==普通session==：这种session的操作的使用类似于PHP原生的session。
>
> ==一次性session==：这种session只可以提取一次数据，在下一个页就会被Laravel销毁掉。适用于在不同页面中传递数据【错误信息，页面提示】。
>
> session类文件：vendor\laravel\framework\src\Illuminate\Session\Store.php
>
> 关于session的常用操作方法：
>
> put	存储一个session数据
>
> get	获取一个session数据
>
> flush	清空session
>
> forget	移除session

### 2.1、普通session

#### 控制器代码

##### 设置session

![1539053993942](1539053993942.png)

##### 获取session

![1539055261153](1539055261153.png)

效果图

![1539055218730](1539055218730.png)

##### 删除session

![1539055637417](1539055637417.png)

> 注意：
>
> ​	在项目开发中一般不会使用flush方法，会经常用使用forget方法。

#### 定义路由

![1539055673179](1539055673179.png)

#### 效果

![1539055682878](1539055682878.png)

### 2.2、一次性session

> 作用：一般使用在表单数据提交失败以后，返回上一页的操作中。

![1539055711879](1539055711879.png)

#### 控制器代码

![1539055969806](1539055969806.png)

#### 定义路由

![1539055997937](1539055997937.png)

#### 效果

![1539056013231](1539056013231.png)

### 2.3、一次性session批量设置

> 当用户提交的数据太多的时候，使用上面的$request->session()->flash()一个个保存会很浪费效率，所以Laravel提供了一个$request->flash()方法，专门给我们用来保存用户提交的数据到一次性session中。

#### 控制器代码

![1539056298079](1539056298079.png)

#### 视图

![1539056322547](1539056322547.png)

视图页面中要用`old`方法回显数据，修改后视图代码如下所示：

![1539056665024](1539056665024.png)

#### 定义路由

![1539056701749](1539056701749.png)

#### 效果

![1539056711417](1539056711417.png)

### 2.4、静态方法设置session

#### 设置session

**控制器代码**

![1539068704408](1539068704408.png)

#### 删除session

![1539068878823](1539068878823.png)

#### 定义路由

![1539068930695](1539068930695.png)

----



# 三、==数据库==

> Laravel框架的数据库配置文件在config/database.php，但是这个文件建议项目上时才进行使用，而在本地开发的时候，一般修改项目根目录下的（.env）文件。

## 1、新建数据库

```sql
CREATE DATABASE `gzphp31` CHARACTER SET 'utf8mb4' COLLATE 'utf8mb4_general_ci';
```

## 2、新建数据表

```sql
为了方便演示，我们这里新增一个member数据表，创建一些测试数据。
CREATE TABLE `user` (
  `id` int unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `username` varchar(150) NOT NULL COMMENT '用户名',
  `nickname` varchar(255) NOT NULL COMMENT '昵称',
  `password` varchar(255) NOT NULL COMMENT '密码',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;
```

![1539057052794](1539057052794.png)

## 3、配置数据库

![1539057004718](1539057004718.png)

> 注意：
>
> ​	如果是使用php artisan serve指令运行着项目，修改项目的配置文件后必须得重启项目，执行ctrl+c键终止项目运行后，再次执行php artisan serve指令运行项目；配置信息才生效。

## 4、数据库操作

> **Laravel的数据库操作提供三种操作：**
>
> 1. ==原生SQL查询==，其实就是使用PHP的PDO类操作
>
> 2. ==DB查询构造器==，其实就是ThinkPHP里面的数据库的连贯操作
>
> 3. ==Eloquent ORM模型==，其实就是ThinkPHP里面的模型类操作

### 4.1、原生SQL查询

> Laravel框架的执行原生SQL语句就是对PHP的PDO预处理进行了一次封装。
>
> 在传值时，要使用占位符的形式。
>
> 要使用Laravel框架执行原生SQL查询，必须在控制器引入数据库操作类DB。
>
> `use Illuminate\Support\Facades\DB;` 等同于 `use DB;`
>
> **DB类对于执行原生SQL语句提供了5个方法：**
>
> DB::select();	查询数据
>
> DB::insert();	添加数据
>
> DB::update();	更新数据
>
> DB::delete();	删除数据
>
> DB::statement();	执行除了增删查改以外的SQL语句

#### 4.1.1、添加数据

##### 控制器代码

![1539067494706](1539067494706.png)

##### 定义路由

![1539067521371](1539067521371.png)

##### 效果

![1539067533200](1539067533200.png)

#### 4.1.3、查询数据

##### 控制器代码

![1539067702479](1539067702479.png)

#### 定义路由

![1539067662060](1539067662060.png)

##### 效果

![1539067635624](1539067635624.png)

#### 4.1.4、更新数据

##### 控制器代码

![1539068034266](1539068034266.png)

##### 定义路由

![1539068064922](1539068064922.png)

##### 效果

![1539068089864](1539068089864.png)

#### 4.2.5、删除数据

##### 控制器代码

![1539068343847](1539068343847.png)

##### 定义路由

![1539068301071](1539068301071.png)

##### 效果

![1539068311389](1539068311389.png)

----



# 四、==缓存==

修改缓存存储机制：config/cache.php

默认存储在文件当中，会存储到：storage/framework/cache/data目录下

## 1、设置缓存

### 控制器代码

```php
Cache::put('key', 'value', $expiresAt);
key: 下标
value：键
$expiresAt：过期时间
```

![1539070741886](1539070741886.png)

### 定义路由

![1539070788033](1539070788033.png)

## 2、删除缓存

### 控制器代码

![1539071028921](1539071028921.png)

### 定义路由

![1539071057014](1539071057014.png)

----



# 五、==DB查询构造器==

> 在Laravel框架，最常用的数据库操作方式就是DB查询构造
>
> 不管是使用use Illuminate\Support\Facades\DB;这方式引入DB或者使用use DB 都是引入它本身。
>
> Laravel 的查询构造器使用 PDO 参数绑定，来保护你的应用程序免受 SQL 注入的攻击。 

## 1、添加数据

DB查询构造器添加数据分为两种：**添加一条数据**，**批量添加数据**

### 1.1、添加一条数据

#### 控制器代码

![1539072031210](1539072031210.png)

#### 定义路由

![1539072061229](1539072061229.png)

#### 效果

![1539072073024](1539072073024.png)

### 1.2、批量添加

#### 控制器代码

![1539072459539](1539072459539.png)

#### 定义路由

![1539072483776](1539072483776.png)

#### 效果

![1539072327187](1539072327187.png)

## 2、查询数据

### 2.1、获取所有数据

#### 控制器代码

![1539072760641](1539072760641.png)

#### 定义路由

![1539072733059](1539072733059.png)

#### 效果

![1539072699497](1539072699497.png)

### 2.2、获取指定字段数据

#### 控制器代码

![1539074117975](1539074117975.png)

#### 定义路由

![1539074081924](1539074081924.png)

#### 效果

![1539074038247](1539074038247.png)

### 2.3、根据ID值获取数据

#### 控制器代码

![1539074455465](1539074455465.png)

#### 定义路由

![1539074429431](1539074429431.png)

#### 效果

![1539074401697](1539074401697.png)

### 2.4、查询一条数据

#### 控制器代码

![1539074858215](1539074858215.png)

#### 定义路由

![1539074885333](1539074885333.png)

#### 效果

![1539074908549](1539074908549.png)

## 3、删除数据

#### 控制器代码

![1539075275034](1539075275034.png)

#### 定义路由

![1539075246150](1539075246150.png)

#### 效果

![1539075207053](1539075207053.png)

## 4、编辑数据

#### 控制器代码

![1539075813041](1539075813041.png)

#### 定义路由

![1539075846189](1539075846189.png)

#### 效果

![1539075858558](1539075858558.png)



## 5、连表查询

> DB查询构造器提供了join方法给我们实现连表查询
>
> 为了方便演示，我们新建一个会员评论表

```sql
create table `comment` (
id int unsigned not null auto_increment primary key comment '主键ID',
uid int unsigned not null comment '会员ID',
created_at timestamp comment '评论时间',
content text comment '评论内容'
) engine=InnoDB;

insert into `comment` (uid,created_at,content) values 
('1','2018-10-07 11:22:00','说的很有道理！！！'),
('1','2018-10-07 11:22:01','说的很有道理！！！'),
('2','2018-10-07 11:22:02','说的很有道理！！！'),
('2','2018-10-07 11:22:33','说的很有道理！！！'),
('3','2018-10-07 11:22:34','说的很有道理！！！'),
('3','2018-10-07 11:22:36','说的很有道理！！！'),
('3','2018-10-07 11:30:33','说的很有道理！！！'),
('3','2018-10-07 11:30:55','说的很有道理！！！');
```

![1539220036027](1539220036027.png)

使用DB查询构造器查询对应用户的评论数据，例如：nickname为“晓莎”的会员的评论

#### 控制器代码

![1539220435575](1539220435575.png)

#### 定义路由

![1539220459835](1539220459835.png)

#### 效果

![1539220468538](1539220468538.png)





